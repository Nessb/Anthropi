{"ast":null,"code":"import _classCallCheck from\"/Users/ness/Docx/anthropi-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/classCallCheck\";import _createClass from\"/Users/ness/Docx/anthropi-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/createClass\";import _possibleConstructorReturn from\"/Users/ness/Docx/anthropi-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/possibleConstructorReturn\";import _getPrototypeOf from\"/Users/ness/Docx/anthropi-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/getPrototypeOf\";import _inherits from\"/Users/ness/Docx/anthropi-react/client/node_modules/babel-preset-react-app/node_modules/@babel/runtime/helpers/esm/inherits\";import React,{Component}from'react';import AdminForm from'./AdminForm';import'./Admin.css';// Firebase\nimport*as firebase from'firebase';var Admin=/*#__PURE__*/function(_Component){_inherits(Admin,_Component);function Admin(){var _getPrototypeOf2;var _this;_classCallCheck(this,Admin);for(var _len=arguments.length,args=new Array(_len),_key=0;_key<_len;_key++){args[_key]=arguments[_key];}_this=_possibleConstructorReturn(this,(_getPrototypeOf2=_getPrototypeOf(Admin)).call.apply(_getPrototypeOf2,[this].concat(args)));_this.state={//user identifiant\nuid:null,//propriétaire de la bdd\nowner:null};_this.authenticate=function(event){//Ne recharge pas la page\nevent.preventDefault();console.log(_this.mail.value,_this.password.value);firebase.auth().signInWithEmailAndPassword(_this.mail.value,_this.password.value).then(function(user){return _this.authHandler(user);});};_this.authHandler=function(user){var ref=firebase.database().ref('test/owner');ref.on('value',function(snapshot){_this.setState({uid:firebase.auth().currentUser.uid,// uid: user.uid,\nowner:snapshot.val()});});};_this.logout=function(){firebase.auth().signOut().then(_this.setState({uid:null}));};_this.renderLogin=function(){return React.createElement(\"div\",{className:\"admin\"},React.createElement(\"header\",{className:\"adminheader\"},React.createElement(\"h1\",{className:\"adminh1\"},\"Administration\")),React.createElement(\"br\",null),React.createElement(\"section\",{className:\"text-center\"},React.createElement(\"form\",{onSubmit:_this.authenticate},React.createElement(\"label\",{htmlFor:\"email\"},\"Email : \"),React.createElement(\"input\",{className:\"mx-2\",placeholder:\"example@.com\",type:\"email\",ref:function ref(input){return _this.mail=input;}}),React.createElement(\"label\",{className:\"mt-3\",htmlFor:\"password\"},\"Mot de passe : \"),React.createElement(\"input\",{placeholder:\"*******\",type:\"password\",ref:function ref(input){return _this.password=input;}}),React.createElement(\"br\",null),React.createElement(\"button\",{className:\"mt-3\",type:\"submit\"},\"Se connecter\"))),React.createElement(\"br\",null));};return _this;}_createClass(Admin,[{key:\"componentDidMount\",// Laisse le dernier utilisateur connecter\nvalue:function componentDidMount(){var user=firebase.auth().currentUser;//  console.log(user)\nif(user){this.authHandler(user);}}},{key:\"render\",value:function render(){var _this2=this;// si il n'y a pas de connexion\nif(!this.state.uid){return this.renderLogin();}if(this.state.uid!==this.state.owner){return this.renderLogin();}var form=Object.keys(this.props.data.contact).map(function(key){return React.createElement(AdminForm,{key:key,id:key,data:_this2.props.data.contact[key]});});return React.createElement(\"div\",{className:\"admin\"},React.createElement(\"header\",{className:\"adminheader\"},React.createElement(\"h1\",{className:\"adminh1\"},\"Administration\")),React.createElement(\"br\",null),form,React.createElement(\"br\",null),React.createElement(\"footer\",null,React.createElement(\"button\",{onClick:this.logout},\"Se d\\xE9connecter\")));}}]);return Admin;}(Component);export default Admin;","map":{"version":3,"sources":["/Users/ness/Docx/anthropi-react/client/src/Admin/Admin.js"],"names":["React","Component","AdminForm","firebase","Admin","state","uid","owner","authenticate","event","preventDefault","console","log","mail","value","password","auth","signInWithEmailAndPassword","then","user","authHandler","ref","database","on","snapshot","setState","currentUser","val","logout","signOut","renderLogin","input","form","Object","keys","props","data","contact","map","key"],"mappings":"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","sourcesContent":["import React, { Component } from 'react'\nimport AdminForm from './AdminForm'\nimport './Admin.css'\n// Firebase\nimport * as firebase from 'firebase'\n\n\nclass Admin extends Component {\n\n    state = {\n    //user identifiant\n    uid: null,\n    //propriétaire de la bdd\n    owner: null\n  }\n  // Laisse le dernier utilisateur connecter\n  componentDidMount () {\n    const user = firebase.auth().currentUser\n    //  console.log(user)\n    if (user) {\n      this.authHandler(user)\n    }\n  }\n\n  authenticate = event => {\n    //Ne recharge pas la page\n    event.preventDefault()\n    console.log(this.mail.value, this.password.value)\n    firebase.auth().signInWithEmailAndPassword(this.mail.value, this.password.value)\n      .then(user => this.authHandler(user) )\n  }  \n\n  authHandler = user => {\n    const ref = firebase.database().ref('test/owner')\n    ref.on('value', snapshot => {\n      this.setState({\n        uid: firebase.auth().currentUser.uid,\n        // uid: user.uid,\n        owner: snapshot.val()\n      })\n    })\n  }\n\n    //Se déconnecter\n    logout = () => {\n        firebase.auth().signOut()\n            .then(this.setState({ uid: null }))\n    }\n\n  renderLogin = () => (\n    <div className='admin'>\n      <header className='adminheader'>\n        <h1 className='adminh1'>Administration</h1>\n      </header>\n      <br />\n      <section className='text-center'>\n        <form onSubmit={this.authenticate}>\n          <label htmlFor=\"email\">Email : </label>\n          <input className='mx-2' placeholder='example@.com' type='email' ref={input => this.mail = input} />\n          <label className='mt-3' htmlFor=\"password\">Mot de passe : </label>\n          <input placeholder='*******' type='password' ref={input => this.password = input} />\n          <br/>\n          <button className='mt-3' type='submit'>Se connecter</button>\n        </form>\n      </section>\n      <br />\n    </div>\n  )\n\n\n  render () {\n    // si il n'y a pas de connexion\n    if (!this.state.uid) {\n      return this.renderLogin()\n    }\n\n    if (this.state.uid !== this.state.owner) {\n      return this.renderLogin()\n    }\n\n    const form = Object.keys(this.props.data.contact).map(key => (\n      <AdminForm key={key} id={key} data={this.props.data.contact[key]} />\n    ))\n    return (\n      <div className='admin'>\n        <header className='adminheader'>\n          <h1 className='adminh1'>Administration</h1>\n        </header>\n        <br />\n        {form}\n        <br />\n        <footer>\n          <button onClick={this.logout}>Se déconnecter</button>\n        </footer>\n      </div>\n    )\n  }\n}\nexport default Admin\n"]},"metadata":{},"sourceType":"module"}